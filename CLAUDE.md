# Claude Code 用作業方針

## 目的
本ドキュメントは、Claude Code が本プロジェクトで作業を行う際の方針とルールを定めたものです。

## 判断記録のルール
1. 判断内容の要約を記載する
2. 検討した代替案を列挙する
3. 採用しなかった案とその理由を明記する
4. 前提条件・仮定・不確実性を明示する
5. 他エージェントによるレビュー可否を示す

## プロジェクト概要
- **目的**: Discord のクロスポストメッセージを検知し、自動翻訳して返信する。
- **主な機能**:
  - クロスポストメッセージのフィルタリング
  - GAS Web App を経由した翻訳処理
  - Discord への翻訳結果投稿

## 重要ルール
- **会話言語**: 日本語
- **コミット規約**: Conventional Commits ( `<description>` は日本語)
- **コメント言語**: 日本語
- **エラーメッセージ**: 英語
- **日本語と英数字の間**: 半角スペースを挿入

## 環境のルール
- **ブランチ命名**: [Conventional Branch](https://conventional-branch.github.io) ( `feat/`, `fix/` 等の短縮形を使用)
- **リポジトリ調査**: GitHub リポジトリを調査する場合は、一時ディレクトリに clone して検索する。
- **Renovate**: Renovate が作成した PR に対して追加コミットを行わない。

## コード改修時のルール
- エラーメッセージの絵文字は、既存の形式がある場合はそれに合わせる。
- TypeScript の `skipLibCheck` は有効にしない。
- 公開関数やインターフェースには日本語で JSDoc を記載する。

## 開発コマンド
```bash
# 依存関係のインストール
pnpm install

# 開発
pnpm dev

# ビルド
pnpm compile

# テスト
pnpm test

# リンター
pnpm lint

# 自動修正
pnpm fix
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント。Bot の起動とイベント登録。
- `src/discord.ts`: Discord.js クライアントのセットアップ。
- `src/event.ts`: メッセージ受信等のイベントハンドリング。
- `src/config.ts`: 設定ファイルの型定義と読み込みロジック。
- `src/utils.ts`: 翻訳処理 (GAS 呼び出し) 等のユーティリティ。

## 作業チェックリスト

### 新規改修時
- [ ] プロジェクトを詳細に分析し理解した
- [ ] 適切なブランチ (feat/fix 等) で作業している
- [ ] 最新のリモートブランチに基づいている
- [ ] 不要なブランチが削除されている
- [ ] pnpm で依存関係をインストールした

### コミット・プッシュ前
- [ ] Conventional Commits に従っている
- [ ] 機密情報が含まれていない
- [ ] `pnpm lint` でエラーがない
- [ ] 動作確認を行った

### PR 作成前
- [ ] ユーザーから作成依頼がある
- [ ] コンフリクトの恐れがない

### PR 作成後
- [ ] PR 本文が最新の状態を網羅している
- [ ] `gh pr checks` で CI がパスすることを確認した
- [ ] Copilot レビュー等に対応した

## リポジトリ固有
- 翻訳には `gas-script.js` を GAS にデプロイして使用する必要がある。
- テストは Jest を使用しており、`utils.test.ts` にユーティリティのテストがある。
